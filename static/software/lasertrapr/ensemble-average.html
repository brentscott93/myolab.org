<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Ensemble Average | Documentation for {lasertrapr}</title>
  <meta name="description" content="Documentation for using the lasertrapr app" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Ensemble Average | Documentation for {lasertrapr}" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Documentation for using the lasertrapr app" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Ensemble Average | Documentation for {lasertrapr}" />
  
  <meta name="twitter:description" content="Documentation for using the lasertrapr app" />
  

<meta name="author" content="Brent Scott" />


<meta name="date" content="2025-07-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summarize.html"/>
<link rel="next" href="figures.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://myolab.org/software/lasertrapr"> lasertrapr </a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#install-r-rstudio"><i class="fa fa-check"></i><b>1.1</b> Install R &amp; RStudio</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#download-lasertrapr"><i class="fa fa-check"></i><b>1.2</b> Download <strong>{lasertrapr}</strong></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#launch-the-app"><i class="fa fa-check"></i><b>1.3</b> Launch the App</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="upload.html"><a href="upload.html"><i class="fa fa-check"></i><b>2</b> Upload Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="upload.html"><a href="upload.html#the-lasertrapr-folder"><i class="fa fa-check"></i><b>2.1</b> The ~/lasertrapr/ folder</a></li>
<li class="chapter" data-level="2.2" data-path="upload.html"><a href="upload.html#create-folders"><i class="fa fa-check"></i><b>2.2</b> Create Folders</a></li>
<li class="chapter" data-level="2.3" data-path="upload.html"><a href="upload.html#load-data"><i class="fa fa-check"></i><b>2.3</b> Load Data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="upload.html"><a href="upload.html#simple-upload"><i class="fa fa-check"></i><b>2.3.1</b> Simple Upload</a></li>
<li class="chapter" data-level="2.3.2" data-path="upload.html"><a href="upload.html#advanced-upload"><i class="fa fa-check"></i><b>2.3.2</b> Advanced Upload</a></li>
<li class="chapter" data-level="2.3.3" data-path="upload.html"><a href="upload.html#lumicks"><i class="fa fa-check"></i><b>2.3.3</b> Lumicks</a></li>
<li class="chapter" data-level="2.3.4" data-path="upload.html"><a href="upload.html#split-observations"><i class="fa fa-check"></i><b>2.3.4</b> Split Observations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="upload.html"><a href="upload.html#tldr"><i class="fa fa-check"></i><b>2.4</b> tl;dr</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="clean-and-process.html"><a href="clean-and-process.html"><i class="fa fa-check"></i><b>3</b> Clean and Process</a>
<ul>
<li class="chapter" data-level="3.1" data-path="clean-and-process.html"><a href="clean-and-process.html#clean"><i class="fa fa-check"></i><b>3.1</b> Clean</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="clean-and-process.html"><a href="clean-and-process.html#cut-data"><i class="fa fa-check"></i><b>3.1.1</b> Cut data</a></li>
<li class="chapter" data-level="3.1.2" data-path="clean-and-process.html"><a href="clean-and-process.html#move-data"><i class="fa fa-check"></i><b>3.1.2</b> Move data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="clean-and-process.html"><a href="clean-and-process.html#process"><i class="fa fa-check"></i><b>3.2</b> Process</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="clean-and-process.html"><a href="clean-and-process.html#convert-to-nm"><i class="fa fa-check"></i><b>3.2.1</b> Convert to nm</a></li>
<li class="chapter" data-level="3.2.2" data-path="clean-and-process.html"><a href="clean-and-process.html#remove-baseline"><i class="fa fa-check"></i><b>3.2.2</b> Remove baseline</a></li>
<li class="chapter" data-level="3.2.3" data-path="clean-and-process.html"><a href="clean-and-process.html#detrend-data"><i class="fa fa-check"></i><b>3.2.3</b> Detrend data</a></li>
<li class="chapter" data-level="3.2.4" data-path="clean-and-process.html"><a href="clean-and-process.html#to-include-or-not-to-include"><i class="fa fa-check"></i><b>3.2.4</b> To Include, or not to Include…</a></li>
<li class="chapter" data-level="3.2.5" data-path="clean-and-process.html"><a href="clean-and-process.html#save"><i class="fa fa-check"></i><b>3.2.5</b> Save!</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="analyzers.html"><a href="analyzers.html"><i class="fa fa-check"></i><b>4</b> Analyzers</a>
<ul>
<li class="chapter" data-level="4.1" data-path="analyzers.html"><a href="analyzers.html#hm-modelchangepoint"><i class="fa fa-check"></i><b>4.1</b> HM-Model/Changepoint</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="analyzers.html"><a href="analyzers.html#options-hm-model"><i class="fa fa-check"></i><b>4.1.1</b> Options: HM-Model</a></li>
<li class="chapter" data-level="4.1.2" data-path="analyzers.html"><a href="analyzers.html#options-changepoint"><i class="fa fa-check"></i><b>4.1.2</b> Options: Changepoint</a></li>
<li class="chapter" data-level="4.1.3" data-path="analyzers.html"><a href="analyzers.html#options-displacements"><i class="fa fa-check"></i><b>4.1.3</b> Options: Displacements</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="analyzers.html"><a href="analyzers.html#mini-ensemble"><i class="fa fa-check"></i><b>4.2</b> Mini-Ensemble</a></li>
<li class="chapter" data-level="4.3" data-path="analyzers.html"><a href="analyzers.html#isometric-force-clamp"><i class="fa fa-check"></i><b>4.3</b> Isometric Force Clamp</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="analyzers.html"><a href="analyzers.html#options-hm-model-1"><i class="fa fa-check"></i><b>4.3.1</b> Options: HM-Model</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="analyzers.html"><a href="analyzers.html#tldr-1"><i class="fa fa-check"></i><b>4.4</b> tl;dr</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="summarize.html"><a href="summarize.html"><i class="fa fa-check"></i><b>5</b> Summarize</a>
<ul>
<li class="chapter" data-level="5.1" data-path="summarize.html"><a href="summarize.html#single--and-mini-ensemble-standard-mode"><i class="fa fa-check"></i><b>5.1</b> Single- and mini-ensemble standard mode</a></li>
<li class="chapter" data-level="5.2" data-path="summarize.html"><a href="summarize.html#isometric-force-clamp-1"><i class="fa fa-check"></i><b>5.2</b> Isometric Force Clamp</a></li>
<li class="chapter" data-level="5.3" data-path="summarize.html"><a href="summarize.html#tldr-2"><i class="fa fa-check"></i><b>5.3</b> tl;dr</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ensemble-average.html"><a href="ensemble-average.html"><i class="fa fa-check"></i><b>6</b> Ensemble Average</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ensemble-average.html"><a href="ensemble-average.html#prep-ensembles"><i class="fa fa-check"></i><b>6.1</b> Prep Ensembles</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ensemble-average.html"><a href="ensemble-average.html#extending-forward"><i class="fa fa-check"></i><b>6.1.1</b> Extending Forward</a></li>
<li class="chapter" data-level="6.1.2" data-path="ensemble-average.html"><a href="ensemble-average.html#extending-backwards"><i class="fa fa-check"></i><b>6.1.2</b> Extending Backwards</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ensemble-average.html"><a href="ensemble-average.html#average-fit-ensembles"><i class="fa fa-check"></i><b>6.2</b> Average &amp; Fit Ensembles</a></li>
<li class="chapter" data-level="6.3" data-path="ensemble-average.html"><a href="ensemble-average.html#plot-ensembles"><i class="fa fa-check"></i><b>6.3</b> Plot Ensembles</a></li>
<li class="chapter" data-level="6.4" data-path="ensemble-average.html"><a href="ensemble-average.html#tldr-3"><i class="fa fa-check"></i><b>6.4</b> tl;dr</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="figures.html"><a href="figures.html"><i class="fa fa-check"></i><b>7</b> Figures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="figures.html"><a href="figures.html#tldr-4"><i class="fa fa-check"></i><b>7.1</b> tl;dr</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Documentation for <strong>{lasertrapr}</strong></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ensemble-average" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Ensemble Average<a href="ensemble-average.html#ensemble-average" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Ensemble averaging in <strong>{lasertrapr}</strong> is divided into three distinct steps 1) preparing the ensembles, 2) averaging and fitting the ensembles, and 3) plotting. Separating these distinct tasks provides the user with more control over the prococess without having to re-run computationally long tasks repeatedly.</p>
<div id="prep-ensembles" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Prep Ensembles<a href="ensemble-average.html#prep-ensembles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An individual single molecule (myosin) event should be composed of two substeps (d1 &amp; d2). Events can be aligned at the changepoint identified start or end of the events, temporally synchronized to the same duration, and then averaged together to create one “average” event. The user can control how the event synchronization occurs.</p>
<p>All the original trapping data traces are saved in the “trap-data.csv” files and their ID’d events are saved in “measured-events.csv”. The “measured-events.csv” file not only includes displacements, event durations, etc., but also the changepoint ID’d datapoint for the start and end of each event. This information can be used for the ensemble averaging.</p>
<p>Ultimately, the “Prep Ensembles” button will create an “ensemble-data.csv” file in each <strong>obs-##</strong> folder that will have all of the individual forwards and backwards extended events that was constructed with the selected parameters described below in one file in long format.</p>
<p>This step usaully takes the most time computationally as it involved reading in every single “trap-data.csv” file, extracting the events, and writing the synchronized events back to the folder.</p>
<p><strong>NOTE:</strong> Only observations that were <strong>included</strong>, analyzed as <strong>success</strong>, and whose <strong>review</strong> marked as TRUE will be included in the ensemble averages. Additionally, if the observation passes that first check then any events that were user excluded will be filtered out. Each time you re-prep your ensembles, all existing “ensemble-data.csv” files are <strong>ERASED</strong> and the data is re-read and prepped again. This allows the user to go back and exclude a trace or event from analysis and re-prep without leaving old straggling files behind.</p>
<div id="extending-forward" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Extending Forward<a href="ensemble-average.html#extending-forward" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The goal with the forward ensemble average is to align the beginning of the events and “stretch” the ends of the short events to be equal to the longest event in time. The app lets the user choose how much (or little) time to use to extend the event. A 3ms “Avg of ms to extend forward” (I should probably come up with better names for these parameters) value means the position of the last 3ms of an events will be averaged and that resulting average value will be used (repeated) to extend the event out. The window size you select would probably be dependent on [ATP]. The higher the [ATP] the lower the window should be to decrease the likelihood of averaging pre-hitch (d1) displacement position. Whereas, at high [ATP] myosin will spend a longer time in a post-hitch (d2) final displacement position waiting for ATP to induce dissociation so you can be less aggressive in the size of the window in attempts to truly capture the average of that final d2 displacement.</p>
</div>
<div id="extending-backwards" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Extending Backwards<a href="ensemble-average.html#extending-backwards" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar idea of the forwards, but for the backward ensemble average the goal is to capture the average position signal of the d1 pre-hitch position signal to extend the events. However, this is a little tricky. The changepoint algorithm used identifies the transition period going from un-bound to bound as a part of the event. This is the very brief period in time where the bead is moving through solution as it is displaced from the center of the trap. As a result, even though these datapoint are considered part of the event, they are not a true representation of the post-powerstroke/pre-hitch d1 position. The app gives the option to “skip” into the event before performing an average in effort to try to avoid averaging in these transition points. The “Number of ms to skip before s1 avg” (again not a catchy name…) lets the user decide how many ms to skip into each event before averaging. Similarly, the “Avg of ms to extend s1 backwards” allows the user to select how many ms to include in the average after skipping ahead.</p>
</div>
</div>
<div id="average-fit-ensembles" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Average &amp; Fit Ensembles<a href="ensemble-average.html#average-fit-ensembles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once the ensembled are prepped they can then be averaged and optionally fit with an exponential curve. The options allow the user to select the maximum amount of data to plot and whether to fit a single, double, or no exponential to the data. This part is relateively strighforward, just click “Avg Ensembles”. Averaging the ensmbles will automatically save the fit parameters under “lasertrapr/project/summary”.</p>
</div>
<div id="plot-ensembles" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Plot Ensembles<a href="ensemble-average.html#plot-ensembles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After the ensembles are averaged and optionally fit, you can navigate to the “Plot Options” tab to activate the graph. Prior to activating this tab only the Forward/Backwards Fit Parameter tables will be view-able.</p>
<p>Within the app, there is a limited selection of plot customizations that allow the user to tweak the appearance of the plot. You can provide custom labels to the facets, change facetting directions, shift the backwards ensembls undernearth the forwards to save on space, change theme size, along with some other minor features. Plots can be saved with “Save Plot” and figures are saved under the selected project folder inside “lasertrapr/project/summary/figures”.</p>
<p><strong>NOTE:</strong> In order to get the custom labels to work you must select a factor order.</p>
</div>
<div id="tldr-3" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> tl;dr<a href="ensemble-average.html#tldr-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Just show me a video…</p>
<video width="800" height="400" controls>
<source src="images/ensemble-average.mp4" type="video/mp4">
<p>Your browser does not support the video tag.
</video></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summarize.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="figures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["lasertrapr-documentation.pdf", "lasertrapr-documentation.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
